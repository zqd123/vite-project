import{Y as X,r as v,y as F,g as m,V as ae,I as N,U as I,d as se,$ as re,l as L,H as j,A as ce,K as ue}from"./index-1a4ae878.js";import{R as ie,i as le}from"./event-8450d90f.js";import{i as $,b as de,_ as fe}from"./el-button-af075d33.js";const ee={tab:"Tab",enter:"Enter",space:"Space",left:"ArrowLeft",up:"ArrowUp",right:"ArrowRight",down:"ArrowDown",esc:"Escape",delete:"Delete",backspace:"Backspace",numpadEnter:"NumpadEnter",pageUp:"PageUp",pageDown:"PageDown",home:"Home",end:"End"};var pe={name:"en",el:{colorpicker:{confirm:"OK",clear:"Clear",defaultLabel:"color picker",description:"current color is {color}. press enter to select a new color."},datepicker:{now:"Now",today:"Today",cancel:"Cancel",clear:"Clear",confirm:"OK",dateTablePrompt:"Use the arrow keys and enter to select the day of the month",monthTablePrompt:"Use the arrow keys and enter to select the month",yearTablePrompt:"Use the arrow keys and enter to select the year",selectedDate:"Selected date",selectDate:"Select date",selectTime:"Select time",startDate:"Start Date",startTime:"Start Time",endDate:"End Date",endTime:"End Time",prevYear:"Previous Year",nextYear:"Next Year",prevMonth:"Previous Month",nextMonth:"Next Month",year:"",month1:"January",month2:"February",month3:"March",month4:"April",month5:"May",month6:"June",month7:"July",month8:"August",month9:"September",month10:"October",month11:"November",month12:"December",week:"week",weeks:{sun:"Sun",mon:"Mon",tue:"Tue",wed:"Wed",thu:"Thu",fri:"Fri",sat:"Sat"},weeksFull:{sun:"Sunday",mon:"Monday",tue:"Tuesday",wed:"Wednesday",thu:"Thursday",fri:"Friday",sat:"Saturday"},months:{jan:"Jan",feb:"Feb",mar:"Mar",apr:"Apr",may:"May",jun:"Jun",jul:"Jul",aug:"Aug",sep:"Sep",oct:"Oct",nov:"Nov",dec:"Dec"}},inputNumber:{decrease:"decrease number",increase:"increase number"},select:{loading:"Loading",noMatch:"No matching data",noData:"No data",placeholder:"Select"},dropdown:{toggleDropdown:"Toggle Dropdown"},cascader:{noMatch:"No matching data",loading:"Loading",placeholder:"Select",noData:"No data"},pagination:{goto:"Go to",pagesize:"/page",total:"Total {total}",pageClassifier:"",page:"Page",prev:"Go to previous page",next:"Go to next page",currentPage:"page {pager}",prevPages:"Previous {pager} pages",nextPages:"Next {pager} pages",deprecationWarning:"Deprecated usages detected, please refer to the el-pagination documentation for more details"},dialog:{close:"Close this dialog"},drawer:{close:"Close this dialog"},messagebox:{title:"Message",confirm:"OK",cancel:"Cancel",error:"Illegal input",close:"Close this dialog"},upload:{deleteTip:"press delete to remove",delete:"Delete",preview:"Preview",continue:"Continue"},slider:{defaultLabel:"slider between {min} and {max}",defaultRangeStartLabel:"pick start value",defaultRangeEndLabel:"pick end value"},table:{emptyText:"No Data",confirmFilter:"Confirm",resetFilter:"Reset",clearFilter:"All",sumText:"Sum"},tree:{emptyText:"No Data"},transfer:{noMatch:"No matching data",noData:"No data",titles:["List 1","List 2"],filterPlaceholder:"Enter keyword",noCheckedFormat:"{total} items",hasCheckedFormat:"{checked}/{total} checked"},image:{error:"FAILED"},pageHeader:{title:"Back"},popconfirm:{confirmButtonText:"Yes",cancelButtonText:"No"}}};const me=e=>(t,o)=>ve(t,o,m(e)),ve=(e,t,o)=>ie(o,e,e).replace(/\{(\w+)\}/g,(a,r)=>{var c;return`${(c=t==null?void 0:t[r])!=null?c:`{${r}}`}`}),Ee=e=>{const t=F(()=>m(e).name),o=ae(e)?e:v(e);return{lang:t,locale:o,t:me(e)}},ge=Symbol("localeContextKey"),Ue=e=>{const t=e||X(ge,v());return Ee(F(()=>t.value||pe))};let E=[];const J=e=>{const t=e;t.key===ee.esc&&E.forEach(o=>o(t))},he=e=>{N(()=>{E.length===0&&document.addEventListener("keydown",J),$&&E.push(e)}),I(()=>{E=E.filter(t=>t!==e),E.length===0&&$&&document.removeEventListener("keydown",J)})},V=v(0),Te=2e3,be=Symbol("zIndexContextKey"),Ke=e=>{const t=e||X(be,void 0),o=F(()=>{const c=m(t);return de(c)?c:Te}),a=F(()=>o.value+V.value);return{initialZIndex:o,currentZIndex:a,nextZIndex:()=>(V.value++,a.value)}},k="focus-trap.focus-after-trapped",_="focus-trap.focus-after-released",ye="focus-trap.focusout-prevented",Y={cancelable:!0,bubbles:!1},Fe={cancelable:!0,bubbles:!1},z="focusAfterTrapped",Z="focusAfterReleased",we=Symbol("elFocusTrap"),D=v(),w=v(0),O=v(0);let T=0;const te=e=>{const t=[],o=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:a=>{const r=a.tagName==="INPUT"&&a.type==="hidden";return a.disabled||a.hidden||r?NodeFilter.FILTER_SKIP:a.tabIndex>=0||a===document.activeElement?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;o.nextNode();)t.push(o.currentNode);return t},W=(e,t)=>{for(const o of e)if(!Se(o,t))return o},Se=(e,t)=>{if(getComputedStyle(e).visibility==="hidden")return!0;for(;e;){if(t&&e===t)return!1;if(getComputedStyle(e).display==="none")return!0;e=e.parentElement}return!1},Pe=e=>{const t=te(e),o=W(t,e),a=W(t.reverse(),e);return[o,a]},Ce=e=>e instanceof HTMLInputElement&&"select"in e,f=(e,t)=>{if(e&&e.focus){const o=document.activeElement;e.focus({preventScroll:!0}),O.value=window.performance.now(),e!==o&&Ce(e)&&t&&e.select()}};function G(e,t){const o=[...e],a=e.indexOf(t);return a!==-1&&o.splice(a,1),o}const xe=()=>{let e=[];return{push:a=>{const r=e[0];r&&a!==r&&r.pause(),e=G(e,a),e.unshift(a)},remove:a=>{var r,c;e=G(e,a),(c=(r=e[0])==null?void 0:r.resume)==null||c.call(r)}}},Le=(e,t=!1)=>{const o=document.activeElement;for(const a of e)if(f(a,t),document.activeElement!==o)return},q=xe(),ke=()=>w.value>O.value,b=()=>{D.value="pointer",w.value=window.performance.now()},Q=()=>{D.value="keyboard",w.value=window.performance.now()},_e=()=>(N(()=>{T===0&&(document.addEventListener("mousedown",b),document.addEventListener("touchstart",b),document.addEventListener("keydown",Q)),T++}),I(()=>{T--,T<=0&&(document.removeEventListener("mousedown",b),document.removeEventListener("touchstart",b),document.removeEventListener("keydown",Q))}),{focusReason:D,lastUserFocusTimestamp:w,lastAutomatedFocusTimestamp:O}),y=e=>new CustomEvent(ye,{...Fe,detail:e}),Ne=se({name:"ElFocusTrap",inheritAttrs:!1,props:{loop:Boolean,trapped:Boolean,focusTrapEl:Object,focusStartEl:{type:[Object,String],default:"first"}},emits:[z,Z,"focusin","focusout","focusout-prevented","release-requested"],setup(e,{emit:t}){const o=v();let a,r;const{focusReason:c}=_e();he(n=>{e.trapped&&!p.paused&&t("release-requested",n)});const p={paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}},g=n=>{if(!e.loop&&!e.trapped||p.paused)return;const{key:s,altKey:u,ctrlKey:i,metaKey:l,currentTarget:M,shiftKey:B}=n,{loop:H}=e,oe=s===ee.tab&&!u&&!i&&!l,h=document.activeElement;if(oe&&h){const P=M,[C,x]=Pe(P);if(C&&x){if(!B&&h===x){const d=y({focusReason:c.value});t("focusout-prevented",d),d.defaultPrevented||(n.preventDefault(),H&&f(C,!0))}else if(B&&[C,P].includes(h)){const d=y({focusReason:c.value});t("focusout-prevented",d),d.defaultPrevented||(n.preventDefault(),H&&f(x,!0))}}else if(h===P){const d=y({focusReason:c.value});t("focusout-prevented",d),d.defaultPrevented||n.preventDefault()}}};re(we,{focusTrapRef:o,onKeydown:g}),L(()=>e.focusTrapEl,n=>{n&&(o.value=n)},{immediate:!0}),L([o],([n],[s])=>{n&&(n.addEventListener("keydown",g),n.addEventListener("focusin",R),n.addEventListener("focusout",A)),s&&(s.removeEventListener("keydown",g),s.removeEventListener("focusin",R),s.removeEventListener("focusout",A))});const S=n=>{t(z,n)},ne=n=>t(Z,n),R=n=>{const s=m(o);if(!s)return;const u=n.target,i=n.relatedTarget,l=u&&s.contains(u);e.trapped||i&&s.contains(i)||(a=i),l&&t("focusin",n),!p.paused&&e.trapped&&(l?r=u:f(r,!0))},A=n=>{const s=m(o);if(!(p.paused||!s))if(e.trapped){const u=n.relatedTarget;!le(u)&&!s.contains(u)&&setTimeout(()=>{if(!p.paused&&e.trapped){const i=y({focusReason:c.value});t("focusout-prevented",i),i.defaultPrevented||f(r,!0)}},0)}else{const u=n.target;u&&s.contains(u)||t("focusout",n)}};async function U(){await j();const n=m(o);if(n){q.push(p);const s=n.contains(document.activeElement)?a:document.activeElement;if(a=s,!n.contains(s)){const i=new Event(k,Y);n.addEventListener(k,S),n.dispatchEvent(i),i.defaultPrevented||j(()=>{let l=e.focusStartEl;ce(l)||(f(l),document.activeElement!==l&&(l="first")),l==="first"&&Le(te(n),!0),(document.activeElement===s||l==="container")&&f(n)})}}}function K(){const n=m(o);if(n){n.removeEventListener(k,S);const s=new CustomEvent(_,{...Y,detail:{focusReason:c.value}});n.addEventListener(_,ne),n.dispatchEvent(s),!s.defaultPrevented&&(c.value=="keyboard"||!ke()||n.contains(document.activeElement))&&f(a??document.body),n.removeEventListener(_,S),q.remove(p)}}return N(()=>{e.trapped&&U(),L(()=>e.trapped,n=>{n?U():K()})}),I(()=>{e.trapped&&K()}),{onKeydown:g}}});function Ie(e,t,o,a,r,c){return ue(e.$slots,"default",{handleKeydown:e.onKeydown})}var Me=fe(Ne,[["render",Ie],["__file","/home/runner/work/element-plus/element-plus/packages/components/focus-trap/src/focus-trap.vue"]]);export{Me as E,we as F,Ke as a,ee as b,Ue as u};
